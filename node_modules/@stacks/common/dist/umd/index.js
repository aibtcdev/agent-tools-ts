!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.StacksCommon=t():e.StacksCommon=t()}(this,(()=>(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var t={};e.r(t),e.d(t,{BLOCKSTACK_DEFAULT_GAIA_HUB_URL:()=>Ee,BLOCKSTACK_HANDLER:()=>N,BadPathError:()=>y,BlockstackError:()=>o,ChainID:()=>le,ConflictError:()=>I,DoesNotExist:()=>m,ERROR_CODES:()=>n,FailedDecryptionError:()=>d,GaiaHubError:()=>p,InvalidAmountError:()=>l,InvalidDIDError:()=>c,InvalidParameterError:()=>s,InvalidStateError:()=>h,Logger:()=>A,LoginFailedError:()=>g,MissingParameterError:()=>i,NoSessionDataError:()=>E,NotEnoughFundsError:()=>u,NotEnoughProofError:()=>R,PRIVATE_KEY_COMPRESSED_LENGTH:()=>de,PRIVATE_KEY_UNCOMPRESSED_LENGTH:()=>he,PayloadTooLargeError:()=>b,PeerNetworkID:()=>fe,PreconditionFailedError:()=>w,RemoteServiceError:()=>a,SignatureVerificationError:()=>f,TransactionVersion:()=>ge,ValidationError:()=>_,alloc:()=>be,asciiToBytes:()=>ne,bigIntToBytes:()=>W,bytesToAscii:()=>oe,bytesToHex:()=>Z,bytesToUtf8:()=>re,concatArray:()=>ce,concatBytes:()=>ae,config:()=>r,equals:()=>_e,fromTwos:()=>Q,getAesCbcOutputLength:()=>U,getBase64OutputLength:()=>B,getGlobalObject:()=>k,getGlobalObjects:()=>j,getGlobalScope:()=>C,hexToBigInt:()=>K,hexToBytes:()=>ee,hexToInt:()=>q,intToBigInt:()=>H,intToBytes:()=>G,intToHex:()=>X,isInstance:()=>ue,isLaterVersion:()=>M,isSameOriginAbsoluteUrl:()=>F,makeUUID4:()=>P,megabytesToBytes:()=>L,nextHour:()=>D,nextMonth:()=>v,nextYear:()=>S,octetsToBytes:()=>ie,parseRecoverableSignatureVrs:()=>me,privateKeyToBytes:()=>ye,readUInt16BE:()=>we,readUInt16LE:()=>Ae,readUInt32BE:()=>Se,readUInt32LE:()=>De,readUInt8:()=>Te,signatureRsvToVrs:()=>Re,signatureVrsToRsv:()=>Ie,toTwos:()=>z,updateQueryStringParameter:()=>$,utf8ToBytes:()=>te,with0x:()=>Y,writeUInt16BE:()=>xe,writeUInt16LE:()=>Ne,writeUInt32BE:()=>ve,writeUInt32LE:()=>Le,writeUInt8:()=>Oe});const r={network:{layer1:"placeholder"},logLevel:"debug"},n={MISSING_PARAMETER:"missing_parameter",REMOTE_SERVICE_ERROR:"remote_service_error",INVALID_STATE:"invalid_state",NO_SESSION_DATA:"no_session_data",DOES_NOT_EXIST:"does_not_exist",FAILED_DECRYPTION_ERROR:"failed_decryption_error",INVALID_DID_ERROR:"invalid_did_error",NOT_ENOUGH_FUNDS_ERROR:"not_enough_error",INVALID_AMOUNT_ERROR:"invalid_amount_error",LOGIN_FAILED_ERROR:"login_failed",SIGNATURE_VERIFICATION_ERROR:"signature_verification_failure",CONFLICT_ERROR:"conflict_error",NOT_ENOUGH_PROOF_ERROR:"not_enough_proof_error",BAD_PATH_ERROR:"bad_path_error",VALIDATION_ERROR:"validation_error",PAYLOAD_TOO_LARGE_ERROR:"payload_too_large_error",PRECONDITION_FAILED_ERROR:"precondition_failed_error",UNKNOWN:"unknown"};Object.freeze(n);class o extends Error{constructor(e){super();let t=e.message,r=`Error Code: ${e.code}`,n=this.stack;if(n)r+=`Stack Trace:\n${n}`;else try{throw new Error}catch(e){n=e.stack}t+=`\nIf you believe this exception is caused by a bug in stacks.js,\n      please file a bug report: https://github.com/blockstack/stacks.js/issues\n\n${r}`,this.message=t,this.code=e.code,this.parameter=e.parameter?e.parameter:void 0}toString(){return`${super.toString()}\n    code: ${this.code} param: ${this.parameter?this.parameter:"n/a"}`}}class s extends o{constructor(e,t=""){super({code:n.MISSING_PARAMETER,message:t,parameter:e}),this.name="MissingParametersError"}}class i extends o{constructor(e,t=""){super({code:n.MISSING_PARAMETER,message:t,parameter:e}),this.name="MissingParametersError"}}class a extends o{constructor(e,t=""){super({code:n.REMOTE_SERVICE_ERROR,message:t}),this.response=e}}class c extends o{constructor(e=""){super({code:n.INVALID_DID_ERROR,message:e}),this.name="InvalidDIDError"}}class u extends o{constructor(e){const t=`Not enough UTXOs to fund. Left to fund: ${e}`;super({code:n.NOT_ENOUGH_FUNDS_ERROR,message:t}),this.leftToFund=e,this.name="NotEnoughFundsError",this.message=t}}class l extends o{constructor(e,t){const r=`Not enough coin to fund fees transaction fees. Fees would be ${e}, specified spend is  ${t}`;super({code:n.INVALID_AMOUNT_ERROR,message:r}),this.specifiedAmount=t,this.fees=e,this.name="InvalidAmountError",this.message=r}}class g extends o{constructor(e){const t=`Failed to login: ${e}`;super({code:n.LOGIN_FAILED_ERROR,message:t}),this.message=t,this.name="LoginFailedError"}}class f extends o{constructor(e){const t=`Failed to verify signature: ${e}`;super({code:n.SIGNATURE_VERIFICATION_ERROR,message:t}),this.message=t,this.name="SignatureVerificationError"}}class d extends o{constructor(e="Unable to decrypt cipher object."){super({code:n.FAILED_DECRYPTION_ERROR,message:e}),this.message=e,this.name="FailedDecryptionError"}}class h extends o{constructor(e){super({code:n.INVALID_STATE,message:e}),this.message=e,this.name="InvalidStateError"}}class E extends o{constructor(e){super({code:n.INVALID_STATE,message:e}),this.message=e,this.name="NoSessionDataError"}}class p extends o{constructor(e,t){super(e),t&&(this.hubError={statusCode:t.status,statusText:t.statusText},"string"==typeof t.body?this.hubError.message=t.body:"object"==typeof t.body&&Object.assign(this.hubError,t.body))}}class m extends p{constructor(e,t){super({message:e,code:n.DOES_NOT_EXIST},t),this.name="DoesNotExist"}}class I extends p{constructor(e,t){super({message:e,code:n.CONFLICT_ERROR},t),this.name="ConflictError"}}class R extends p{constructor(e,t){super({message:e,code:n.NOT_ENOUGH_PROOF_ERROR},t),this.name="NotEnoughProofError"}}class y extends p{constructor(e,t){super({message:e,code:n.BAD_PATH_ERROR},t),this.name="BadPathError"}}class _ extends p{constructor(e,t){super({message:e,code:n.VALIDATION_ERROR},t),this.name="ValidationError"}}class b extends p{constructor(e,t,r){super({message:e,code:n.PAYLOAD_TOO_LARGE_ERROR},t),this.name="PayloadTooLargeError",this.maxUploadByteSize=r}}class w extends p{constructor(e,t){super({message:e,code:n.PRECONDITION_FAILED_ERROR},t),this.name="PreconditionFailedError"}}const x=["debug","info","warn","error","none"],T={},O={};for(let e=0;e<x.length;e++){const t=x[e];T[t]=e,O[e]=t}class A{static error(e){this.shouldLog("error")&&console.error(this.logMessage("error",e))}static warn(e){this.shouldLog("warn")&&console.warn(this.logMessage("warn",e))}static info(e){this.shouldLog("info")&&console.log(this.logMessage("info",e))}static debug(e){this.shouldLog("debug")&&console.log(this.logMessage("debug",e))}static logMessage(e,t){return`[${e.toUpperCase()}] ${t}`}static shouldLog(e){return T[r.logLevel]<=T[e]}}const N="blockstack";function S(){return new Date((new Date).setFullYear((new Date).getFullYear()+1))}function v(){return new Date((new Date).setMonth((new Date).getMonth()+1))}function D(){return new Date((new Date).setHours((new Date).getHours()+1))}function L(e){return Number.isFinite(e)?Math.floor(1024*e*1024):0}function U(e){return 16*(Math.floor(e/16)+1)}function B(e){return 4*Math.ceil(e/3)}function $(e,t,r){const n=new RegExp(`([?&])${t}=.*?(&|$)`,"i"),o=-1!==e.indexOf("?")?"&":"?";return e.match(n)?e.replace(n,`$1${t}=${r}$2`):`${e}${o}${t}=${r}`}function M(e,t){void 0!==e&&""!==e||(e="0.0.0"),void 0!==t&&""!==e||(t="0.0.0");const r=e.split(".").map((e=>parseInt(e,10))),n=t.split(".").map((e=>parseInt(e,10)));for(let o=0;o<t.length;o++)if(o>=e.length&&n.push(0),r[o]<n[o])return!1;return!0}function P(){let e=(new Date).getTime();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?r:3&r|8).toString(16)}))}function F(e,t){try{const r=new URL(e),n=new URL(t),o=0|parseInt(r.port||"0",10)||("https:"===r.protocol?443:80),s=0|parseInt(n.port||"0",10)||("https:"===n.protocol?443:80),i={scheme:r.protocol===n.protocol,hostname:r.hostname===n.hostname,port:o===s,absolute:(e.includes("http://")||e.includes("https://"))&&(t.includes("http://")||t.includes("https://"))};return i.scheme&&i.hostname&&i.port&&i.absolute}catch(e){return console.log(e),console.log("Parsing error in same URL origin check"),!1}}function C(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e.g)return e.g;throw new Error("Unexpected runtime environment - no supported global scope (`window`, `self`, `global`) available")}function V(e,t,r){return r?`Use of '${r}' requires \`${t}\` which is unavailable on the '${e}' object within the currently executing environment.`:`\`${t}\` is unavailable on the '${e}' object within the currently executing environment.`}function k(e,{throwIfUnavailable:t,usageDesc:r,returnEmptyObject:n}={}){let o;try{if(o=C(),o){const t=o[e];if(t)return t}}catch(t){A.error(`Error getting object '${e}' from global scope '${o}': ${t}`)}if(t){const t=V(o,e.toString(),r);throw A.error(t),new Error(t)}if(n)return{}}function j(e,{throwIfUnavailable:t,usageDesc:r,returnEmptyObject:n}={}){let o;try{o=C()}catch(s){if(A.error(`Error getting global scope: ${s}`),t){const t=V(o,e[0].toString(),r);throw A.error(t),t}n&&(o={})}const s={};for(let i=0;i<e.length;i++){const a=e[i];try{if(o){const e=o[a];if(e)s[a]=e;else{if(t){const e=V(o,a.toString(),r);throw A.error(e),new Error(e)}n&&(s[a]={})}}}catch(e){if(t){const e=V(o,a.toString(),r);throw A.error(e),new Error(e)}}}return s}function G(e,t,r){return W(H(e,t),r)}function H(e,t){let r=e;if("number"==typeof r){if(!Number.isInteger(r))throw new RangeError("Invalid value. Values of type 'number' must be an integer.");if(r>Number.MAX_SAFE_INTEGER)throw new RangeError(`Invalid value. Values of type 'number' must be less than or equal to ${Number.MAX_SAFE_INTEGER}. For larger values, try using a BigInt instead.`);return BigInt(r)}if("string"==typeof r)if(r.toLowerCase().startsWith("0x")){let e=r.slice(2);e=e.padStart(e.length+e.length%2,"0"),r=ee(e)}else try{return BigInt(r)}catch(e){if(e instanceof SyntaxError)throw new RangeError(`Invalid value. String integer '${r}' is not finite.`)}if("bigint"==typeof r)return r;if(r instanceof Uint8Array){if(t){const e=Q(BigInt(`0x${Z(r)}`),BigInt(8*r.byteLength));return BigInt(e.toString())}return BigInt(`0x${Z(r)}`)}if(null!=r&&"object"==typeof r&&"BN"===r.constructor.name)return BigInt(r.toString());throw new TypeError("Invalid value type. Must be a number, bigint, integer-string, hex-string, or Uint8Array.")}function Y(e){return e.startsWith("0x")?e:`0x${e}`}function K(e){if("string"!=typeof e)throw new TypeError("hexToBigInt: expected string, got "+typeof e);return BigInt(`0x${e}`)}function X(e,t=8){return("bigint"==typeof e?e:H(e,!1)).toString(16).padStart(2*t,"0")}function q(e){return parseInt(e,16)}function W(e,t=16){return ee(X(e,t))}function z(e,t){if(e<-(BigInt(1)<<t-BigInt(1))||(BigInt(1)<<t-BigInt(1))-BigInt(1)<e)throw`Unable to represent integer in width: ${t}`;return e>=BigInt(0)?BigInt(e):e+(BigInt(1)<<t)}function Q(e,t){return function(e,t){return e&BigInt(1)<<t}(e,t-BigInt(1))?e-(BigInt(1)<<t):e}const J=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function Z(e){if(!(e instanceof Uint8Array))throw new Error("Uint8Array expected");let t="";for(const r of e)t+=J[r];return t}function ee(e){if("string"!=typeof e)throw new TypeError("hexToBytes: expected string, got "+typeof e);const t=e.length%2?`0${e}`:e,r=new Uint8Array(t.length/2);for(let e=0;e<r.length;e++){const n=2*e,o=t.slice(n,n+2),s=Number.parseInt(o,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");r[e]=s}return r}function te(e){return(new TextEncoder).encode(e)}function re(e){return(new TextDecoder).decode(e)}function ne(e){const t=[];for(let r=0;r<e.length;r++)t.push(255&e.charCodeAt(r));return new Uint8Array(t)}function oe(e){return String.fromCharCode.apply(null,e)}function se(e){return!Number.isInteger(e)||e<0||e>255}function ie(e){if(e.some(se))throw new Error("Some values are invalid bytes.");return new Uint8Array(e)}function ae(...e){if(!e.every((e=>e instanceof Uint8Array)))throw new Error("Uint8Array list expected");if(1===e.length)return e[0];const t=e.reduce(((e,t)=>e+t.length),0),r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){const o=e[t];r.set(o,n),n+=o.length}return r}function ce(e){return ae(...e.map((e=>"number"==typeof e?ie([e]):e instanceof Array?ie(e):e)))}function ue(e,t){var r,n;return e instanceof t||(null==(n=null==(r=null==e?void 0:e.constructor)?void 0:r.name)?void 0:n.toLowerCase())===t.name}var le=(e=>(e[e.Testnet=2147483648]="Testnet",e[e.Mainnet=1]="Mainnet",e))(le||{}),ge=(e=>(e[e.Mainnet=0]="Mainnet",e[e.Testnet=128]="Testnet",e))(ge||{}),fe=(e=>(e[e.Mainnet=385875968]="Mainnet",e[e.Testnet=4278190080]="Testnet",e))(fe||{});const de=33,he=32,Ee="https://hub.blockstack.org",pe=32;function me(e){if(e.length<2*pe*2+1)throw new Error("Invalid signature");const t=e.slice(0,2),r=e.slice(2,2+2*pe),n=e.slice(2+2*pe);return{recoveryId:q(t),r,s:n}}function Ie(e){return e.slice(2)+e.slice(0,2)}function Re(e){return e.slice(-2)+e.slice(0,-2)}function ye(e){const t="string"==typeof e?ee(e):e;if(32!=t.length&&33!=t.length)throw new Error(`Improperly formatted private-key. Private-key byte length should be 32 or 33. Length provided: ${t.length}`);if(33==t.length&&1!==t[32])throw new Error("Improperly formatted private-key. 33 bytes indicate compressed key, but the last byte must be == 01");return t}function _e(e,t){if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function be(e,t){const r=new Uint8Array(e);for(let n=0;n<e;n++)r[n]=t;return r}function we(e,t){return(e[t+0]<<8|e[t+1])>>>0}function xe(e,t,r){e[r+0]=t>>>8,e[r+1]=t>>>0}function Te(e,t){return e[t]}function Oe(e,t,r){e[r]=t}function Ae(e,t){return e[t+0]<<0>>>0|e[t+1]<<8>>>0}function Ne(e,t,r){e[r+0]=255&t,t>>>=8,e[r+1]=255&t}function Se(e,t){return e[t]*2**24+65536*e[t+1]+256*e[t+2]+e[t+3]}function ve(e,t,r){e[r+3]=t,t>>>=8,e[r+2]=t,t>>>=8,e[r+1]=t,t>>>=8,e[r]=t}function De(e,t){return e[t+0]<<0>>>0|e[t+1]<<8>>>0|e[t+2]<<16>>>0|e[t+3]<<24>>>0}function Le(e,t,r){e[r+0]=255&t,t>>>=8,e[r+1]=255&t,t>>>=8,e[r+2]=255&t,t>>>=8,e[r+3]=255&t}return t})()));
//# sourceMappingURL=index.js.map